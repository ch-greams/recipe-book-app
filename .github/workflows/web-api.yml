name: web-api

on:
    push:
        branches:
            - main
            - develop
        paths:
            - services/web-api/**
            - .github/workflows/web-api.yml
    pull_request:
        branches:
            - main
            - develop
        paths:
            - services/web-api/**
            - .github/workflows/web-api.yml

    # Allows you to run this workflow manually from the Actions tab
    workflow_dispatch:

jobs:

    check:
        runs-on: ubuntu-20.04

        steps:
            - uses: actions/checkout@v2

            - name: Install stable toolchain
              uses: actions-rs/toolchain@v1
              with:
                  profile: minimal
                  toolchain: stable
                  override: true

            - name: Run cargo check
              uses: actions-rs/cargo@v1
              with:
                  command: check
                  args: --manifest-path services/web-api/Cargo.toml

    lint:
        runs-on: ubuntu-20.04

        steps:
            - uses: actions/checkout@v2

            - name: Install stable toolchain
              uses: actions-rs/toolchain@v1
              with:
                  profile: minimal
                  toolchain: stable
                  override: true
                  components: rustfmt, clippy

            - name: Run cargo fmt
              uses: actions-rs/cargo@v1
              with:
                  command: fmt
                  args: --manifest-path services/web-api/Cargo.toml --all -- --check

            - name: Run cargo clippy
              uses: actions-rs/cargo@v1
              with:
                  command: clippy
                  args: --manifest-path services/web-api/Cargo.toml -- -D warnings

    test:
        runs-on: ubuntu-20.04

        steps:
            - uses: actions/checkout@v2

            - name: Install stable toolchain
              uses: actions-rs/toolchain@v1
              with:
                  profile: minimal
                  toolchain: stable
                  override: true

            - name: Run cargo test
              uses: actions-rs/cargo@v1
              with:
                  command: test
                  args: --manifest-path services/web-api/Cargo.toml
